#!/usr/bin/env python3

import datetime
from objchanges import diff, patch

prev=[{'end': '2008-05-08T00:00:00', 'committee_id': 'AFCO', 'start': '2007-01-31T00:00:00', 'role': 'Member', 'abbr': 'AFCO', 'Organization': 'Committee on Constitutional Affairs'}, {'end': '2008-05-08T00:00:00', 'committee_id': 'ENVI', 'start': '2007-01-31T00:00:00', 'role': 'Substitute', 'abbr': 'ENVI', 'Organization': 'Committee on the Environment, Public Health and Food Safety'}, {'end': '2008-05-08T00:00:00', 'committee_id': 'CONT', 'start': '2007-01-31T00:00:00', 'role': 'Substitute', 'abbr': 'CONT', 'Organization': 'Committee on Budgetary Control'}, {'end': '2008-05-08T00:00:00', 'committee_id': 'IMCO', 'start': '2007-12-06T00:00:00', 'role': 'Substitute', 'abbr': 'IMCO', 'Organization': 'Committee on the Internal Market and Consumer Protection'}, {'end': '2007-10-07T00:00:00', 'committee_id': 'IMCO', 'start': '2007-01-31T00:00:00', 'role': 'Substitute', 'abbr': 'IMCO', 'Organization': 'Committee on the Internal Market and Consumer Protection'}, {'end': '2007-01-30T00:00:00', 'committee_id': 'AFCO', 'start': '2007-01-15T00:00:00', 'role': 'Member', 'abbr': 'AFCO', 'Organization': 'Committee on Constitutional Affairs'}, {'end': '2007-01-30T00:00:00', 'committee_id': 'CONT', 'start': '2007-01-15T00:00:00', 'role': 'Substitute', 'abbr': 'CONT', 'Organization': 'Committee on Budgetary Control'}, {'end': '2007-01-30T00:00:00', 'committee_id': 'IMCO', 'start': '2007-01-15T00:00:00', 'role': 'Substitute', 'abbr': 'IMCO', 'Organization': 'Committee on the Internal Market and Consumer Protection'}, {'end': '2007-01-14T00:00:00', 'committee_id': 'AFCO', 'start': '2004-07-21T00:00:00', 'role': 'Member', 'abbr': 'AFCO', 'Organization': 'Committee on Constitutional Affairs'}, {'end': '2007-01-14T00:00:00', 'committee_id': 'CONT', 'start': '2004-07-21T00:00:00', 'role': 'Substitute', 'abbr': 'CONT', 'Organization': 'Committee on Budgetary Control'}, {'end': '2007-01-14T00:00:00', 'committee_id': 'IMCO', 'start': '2006-09-22T00:00:00', 'role': 'Substitute', 'abbr': 'IMCO', 'Organization': 'Committee on the Internal Market and Consumer Protection'}, {'Organization': 'Temporary committee on policy challenges and budgetary means of the enlarged Union 2007-2013', 'role': 'Substitute', 'end': '2005-06-08T00:00:00', 'abbr': None, 'start': '2004-10-14T00:00:00'}, {'end': '2004-07-19T00:00:00', 'committee_id': 'AFCO', 'start': '2002-01-17T00:00:00', 'role': 'Member', 'abbr': 'AFCO', 'Organization': 'Committee on Constitutional Affairs'}, {'end': '2004-07-19T00:00:00', 'committee_id': 'CONT', 'start': '2003-09-29T00:00:00', 'role': 'Substitute', 'abbr': 'CONT', 'Organization': 'Committee on Budgetary Control'}, {'end': '2002-01-14T00:00:00', 'committee_id': 'AFCO', 'start': '1999-07-21T00:00:00', 'role': 'Member', 'abbr': 'AFCO', 'Organization': 'Committee on Constitutional Affairs'}, {'end': '2001-04-23T00:00:00', 'committee_id': 'CONT', 'start': '1999-07-21T00:00:00', 'role': 'Substitute', 'abbr': 'CONT', 'Organization': 'Committee on Budgetary Control'}, {'Organization': 'Committee on Institutional Affairs', 'role': 'Member', 'end': '1999-07-19T00:00:00', 'abbr': None, 'start': '1997-01-16T00:00:00'}, {'Organization': 'Committee on Research, Technological Development and Energy', 'role': 'Substitute', 'end': '1997-07-17T00:00:00', 'abbr': None, 'start': '1997-01-16T00:00:00'}, {'Organization': 'Committee on Institutional Affairs', 'role': 'Member', 'end': '1997-01-15T00:00:00', 'abbr': None, 'start': '1994-07-21T00:00:00'}, {'Organization': 'Subcommittee on Security and Disarmament', 'role': 'Substitute', 'end': '1997-01-15T00:00:00', 'abbr': None, 'start': '1994-07-21T00:00:00'}, {'Organization': 'Committee on Foreign Affairs, Security and Defence Policy', 'role': 'Substitute', 'end': '1997-01-15T00:00:00', 'abbr': None, 'start': '1994-08-10T00:00:00'}, {'end': '1996-05-09T00:00:00', 'committee_id': 'DROI', 'start': '1994-07-21T00:00:00', 'role': 'Member', 'abbr': 'DROI', 'Organization': 'Subcommittee on Human Rights'}, {'Organization': 'Committee on Foreign Affairs, Security and Defence Policy', 'role': 'Member', 'end': '1994-08-10T00:00:00', 'abbr': None, 'start': '1994-07-21T00:00:00'}, {'Organization': 'Committee on Economic and Monetary Affairs and Industrial Policy', 'role': 'Member', 'end': '1994-07-18T00:00:00', 'abbr': None, 'start': '1992-01-15T00:00:00'}, {'Organization': 'Committee on Institutional Affairs', 'role': 'Substitute', 'end': '1994-07-18T00:00:00', 'abbr': None, 'start': '1992-01-15T00:00:00'}, {'Organization': 'Committee on Agriculture, Fisheries and Rural Development', 'role': 'Substitute', 'end': '1992-09-14T00:00:00', 'abbr': None, 'start': '1992-01-15T00:00:00'}, {'Organization': 'Committee on Energy, Research and Technology', 'role': 'Member', 'end': '1992-01-14T00:00:00', 'abbr': None, 'start': '1989-10-13T00:00:00'}, {'Organization': 'Committee on Institutional Affairs', 'role': 'Substitute', 'end': '1992-01-14T00:00:00', 'abbr': None, 'start': '1989-07-26T00:00:00'}, {'Organization': 'Committee on Economic and Monetary Affairs and Industrial Policy', 'role': 'Substitute', 'end': '1992-01-14T00:00:00', 'abbr': None, 'start': '1989-09-15T00:00:00'}, {'Organization': 'Committee on Transports and Tourism', 'role': 'Member', 'end': '1989-10-13T00:00:00', 'abbr': None, 'start': '1989-07-26T00:00:00'}, {'Organization': 'Committee on Agriculture, Fisheries and Rural Development', 'role': 'Substitute', 'end': '1989-10-11T00:00:00', 'abbr': None, 'start': '1989-07-26T00:00:00'}, {'end': '1989-07-24T00:00:00', 'committee_id': 'BUDG', 'start': '1987-01-21T00:00:00', 'role': 'Member', 'abbr': 'BUDG', 'Organization': 'Committee on Budgets'}, {'Organization': 'Committee on Institutional Affairs', 'role': 'Substitute', 'end': '1989-07-24T00:00:00', 'abbr': None, 'start': '1987-01-21T00:00:00'}, {'end': '1987-01-20T00:00:00', 'committee_id': 'BUDG', 'start': '1984-07-26T00:00:00', 'role': 'Member', 'abbr': 'BUDG', 'Organization': 'Committee on Budgets'}, {'Organization': 'Committee on Development and Cooperation', 'role': 'Substitute', 'end': '1987-01-20T00:00:00', 'abbr': None, 'start': '1984-09-24T00:00:00'}, {'end': '1984-07-23T00:00:00', 'committee_id': 'BUDG', 'start': '1979-07-20T00:00:00', 'role': 'Member', 'abbr': 'BUDG', 'Organization': 'Committee on Budgets'}]
mep=[{'role': 'Member', 'Organization': 'Committee on Constitutional Affairs', 'start': datetime.datetime(2004, 7, 21, 0, 0).isoformat(), 'end': datetime.datetime(2007, 1, 14, 0, 0).isoformat(), 'term': 6, 'abbr': 'AFCO'}, {'role': 'Member', 'Organization': 'Committee on Constitutional Affairs', 'start': datetime.datetime(2007, 1, 15, 0, 0).isoformat(), 'end': datetime.datetime(2007, 1, 30, 0, 0).isoformat(), 'term': 6, 'abbr': 'AFCO'}, {'role': 'Member', 'Organization': 'Committee on Constitutional Affairs', 'start': datetime.datetime(2007, 1, 31, 0, 0).isoformat(), 'end': datetime.datetime(2008, 5, 8, 0, 0).isoformat(), 'term': 6, 'abbr': 'AFCO'}, {'role': 'Substitute', 'Organization': 'Committee on Budgetary Control', 'start': datetime.datetime(2004, 7, 21, 0, 0).isoformat(), 'end': datetime.datetime(2007, 1, 14, 0, 0).isoformat(), 'term': 6, 'abbr': 'CONT'}, {'role': 'Substitute', 'Organization': 'Temporary committee on policy challenges and budgetary means of the enlarged Union 2007-2013', 'start': datetime.datetime(2004, 10, 14, 0, 0).isoformat(), 'end': datetime.datetime(2005, 6, 8, 0, 0).isoformat(), 'term': 6, 'abbr': ''}, {'role': 'Substitute', 'Organization': 'Committee on the Internal Market and Consumer Protection', 'start': datetime.datetime(2006, 9, 22, 0, 0).isoformat(), 'end': datetime.datetime(2007, 1, 14, 0, 0).isoformat(), 'term': 6, 'abbr': 'IMCO'}, {'role': 'Substitute', 'Organization': 'Committee on Budgetary Control', 'start': datetime.datetime(2007, 1, 15, 0, 0).isoformat(), 'end': datetime.datetime(2007, 1, 30, 0, 0).isoformat(), 'term': 6, 'abbr': 'CONT'}, {'role': 'Substitute', 'Organization': 'Committee on the Internal Market and Consumer Protection', 'start': datetime.datetime(2007, 1, 15, 0, 0).isoformat(), 'end': datetime.datetime(2007, 1, 30, 0, 0).isoformat(), 'term': 6, 'abbr': 'IMCO'}, {'role': 'Substitute', 'Organization': 'Committee on the Internal Market and Consumer Protection', 'start': datetime.datetime(2007, 1, 31, 0, 0).isoformat(), 'end': datetime.datetime(2007, 10, 7, 0, 0).isoformat(), 'term': 6, 'abbr': 'IMCO'}, {'role': 'Substitute', 'Organization': 'Committee on Budgetary Control', 'start': datetime.datetime(2007, 1, 31, 0, 0).isoformat(), 'end': datetime.datetime(2008, 5, 8, 0, 0).isoformat(), 'term': 6, 'abbr': 'CONT'}, {'role': 'Substitute', 'Organization': 'Committee on the Environment, Public Health and Food Safety', 'start': datetime.datetime(2007, 1, 31, 0, 0).isoformat(), 'end': datetime.datetime(2008, 5, 8, 0, 0).isoformat(), 'term': 6, 'abbr': 'ENVI'}, {'role': 'Substitute', 'Organization': 'Committee on the Internal Market and Consumer Protection', 'start': datetime.datetime(2007, 12, 6, 0, 0).isoformat(), 'end': datetime.datetime(2008, 5, 8, 0, 0).isoformat(), 'term': 6, 'abbr': 'IMCO'}, {'role': 'Member', 'Organization': 'Committee on Constitutional Affairs', 'start': datetime.datetime(1999, 7, 21, 0, 0).isoformat(), 'end': datetime.datetime(2002, 1, 14, 0, 0).isoformat(), 'term': 5, 'abbr': 'AFCO'}, {'role': 'Member', 'Organization': 'Committee on Constitutional Affairs', 'start': datetime.datetime(2002, 1, 17, 0, 0).isoformat(), 'end': datetime.datetime(2004, 7, 19, 0, 0).isoformat(), 'term': 5, 'abbr': 'AFCO'}, {'role': 'Substitute', 'Organization': 'Committee on Budgetary Control', 'start': datetime.datetime(1999, 7, 21, 0, 0).isoformat(), 'end': datetime.datetime(2001, 4, 23, 0, 0).isoformat(), 'term': 5, 'abbr': 'CONT'}, {'role': 'Substitute', 'Organization': 'Committee on Budgetary Control', 'start': datetime.datetime(2003, 9, 29, 0, 0).isoformat(), 'end': datetime.datetime(2004, 7, 19, 0, 0).isoformat(), 'term': 5, 'abbr': 'CONT'}, {'role': 'Member', 'Organization': 'Committee on Foreign Affairs, Security and Defence Policy', 'start': datetime.datetime(1994, 7, 21, 0, 0).isoformat(), 'end': datetime.datetime(1994, 8, 10, 0, 0).isoformat(), 'term': 4, 'abbr': 'AFET'}, {'role': 'Member', 'Organization': 'Subcommittee on Human Rights', 'start': datetime.datetime(1994, 7, 21, 0, 0).isoformat(), 'end': datetime.datetime(1996, 5, 9, 0, 0).isoformat(), 'term': 4, 'abbr': 'DROI'}, {'role': 'Member', 'Organization': 'Committee on Institutional Affairs', 'start': datetime.datetime(1994, 7, 21, 0, 0).isoformat(), 'end': datetime.datetime(1997, 1, 15, 0, 0).isoformat(), 'term': 4, 'abbr': ''}, {'role': 'Member', 'Organization': 'Committee on Institutional Affairs', 'start': datetime.datetime(1997, 1, 16, 0, 0).isoformat(), 'end': datetime.datetime(1999, 7, 19, 0, 0).isoformat(), 'term': 4, 'abbr': ''}, {'role': 'Substitute', 'Organization': 'Subcommittee on Security and Disarmament', 'start': datetime.datetime(1994, 7, 21, 0, 0).isoformat(), 'end': datetime.datetime(1997, 1, 15, 0, 0).isoformat(), 'term': 4, 'abbr': ''}, {'role': 'Substitute', 'Organization': 'Committee on Foreign Affairs, Security and Defence Policy', 'start': datetime.datetime(1994, 8, 10, 0, 0).isoformat(), 'end': datetime.datetime(1997, 1, 15, 0, 0).isoformat(), 'term': 4, 'abbr': 'AFET'}, {'role': 'Substitute', 'Organization': 'Committee on Research, Technological Development and Energy', 'start': datetime.datetime(1997, 1, 16, 0, 0).isoformat(), 'end': datetime.datetime(1997, 7, 17, 0, 0).isoformat(), 'term': 4, 'abbr': ''}, {'role': 'Member', 'Organization': 'Committee on Transports and Tourism', 'start': datetime.datetime(1989, 7, 26, 0, 0).isoformat(), 'end': datetime.datetime(1989, 10, 13, 0, 0).isoformat(), 'term': 3, 'abbr': ''}, {'role': 'Member', 'Organization': 'Committee on Energy, Research and Technology', 'start': datetime.datetime(1989, 10, 13, 0, 0).isoformat(), 'end': datetime.datetime(1992, 1, 14, 0, 0).isoformat(), 'term': 3, 'abbr': ''}, {'role': 'Member', 'Organization': 'Committee on Economic and Monetary Affairs and Industrial Policy', 'start': datetime.datetime(1992, 1, 15, 0, 0).isoformat(), 'end': datetime.datetime(1994, 7, 18, 0, 0).isoformat(), 'term': 3, 'abbr': ''}, {'role': 'Substitute', 'Organization': 'Committee on Agriculture, Fisheries and Rural Development', 'start': datetime.datetime(1989, 7, 26, 0, 0).isoformat(), 'end': datetime.datetime(1989, 10, 11, 0, 0).isoformat(), 'term': 3, 'abbr': ''}, {'role': 'Substitute', 'Organization': 'Committee on Institutional Affairs', 'start': datetime.datetime(1989, 7, 26, 0, 0).isoformat(), 'end': datetime.datetime(1992, 1, 14, 0, 0).isoformat(), 'term': 3, 'abbr': ''}, {'role': 'Substitute', 'Organization': 'Committee on Economic and Monetary Affairs and Industrial Policy', 'start': datetime.datetime(1989, 9, 15, 0, 0).isoformat(), 'end': datetime.datetime(1992, 1, 14, 0, 0).isoformat(), 'term': 3, 'abbr': ''}, {'role': 'Substitute', 'Organization': 'Committee on Agriculture, Fisheries and Rural Development', 'start': datetime.datetime(1992, 1, 15, 0, 0).isoformat(), 'end': datetime.datetime(1992, 9, 14, 0, 0).isoformat(), 'term': 3, 'abbr': ''}, {'role': 'Substitute', 'Organization': 'Committee on Institutional Affairs', 'start': datetime.datetime(1992, 1, 15, 0, 0).isoformat(), 'end': datetime.datetime(1994, 7, 18, 0, 0).isoformat(), 'term': 3, 'abbr': ''}, {'role': 'Member', 'Organization': 'Committee on Budgets', 'start': datetime.datetime(1984, 7, 26, 0, 0).isoformat(), 'end': datetime.datetime(1987, 1, 20, 0, 0).isoformat(), 'term': 2, 'abbr': 'BUDG'}, {'role': 'Member', 'Organization': 'Committee on Budgets', 'start': datetime.datetime(1987, 1, 21, 0, 0).isoformat(), 'end': datetime.datetime(1989, 7, 24, 0, 0).isoformat(), 'term': 2, 'abbr': 'BUDG'}, {'role': 'Substitute', 'Organization': 'Committee on Development and Cooperation', 'start': datetime.datetime(1984, 9, 24, 0, 0).isoformat(), 'end': datetime.datetime(1987, 1, 20, 0, 0).isoformat(), 'term': 2, 'abbr': ''}, {'role': 'Substitute', 'Organization': 'Committee on Institutional Affairs', 'start': datetime.datetime(1987, 1, 21, 0, 0).isoformat(), 'end': datetime.datetime(1989, 7, 24, 0, 0).isoformat(), 'term': 2, 'abbr': ''}, {'role': 'Member', 'Organization': 'Committee on Budgets', 'start': datetime.datetime(1979, 7, 20, 0, 0).isoformat(), 'end': datetime.datetime(1984, 7, 23, 0, 0).isoformat(), 'term': 1, 'abbr': 'BUDG'}]

def test(a, b):
    print("x"*80)
    #for i, x in enumerate(a): print("%2d" % i,sorted(x.items()))
    #print("")
    #for i, x in enumerate(b): print("%2d" % i,sorted(x.items()))
    d = diff(a,b)
    #print("")
    #for x in d: print(x)
    #print("")
    p = patch(a, d)
    assert p is not None
    tmp = diff(p,b)
    assert (tmp==None) or (len(tmp) == 0)
    if isinstance(tmp,list) and (len(tmp) != 0):
        print("patch(a, diff(a,b))!=b")
        for c in tmp:
            print(c)

test(prev[31:34],mep[31:34])
test(prev[31:35],mep[31:34])
test(prev[31:34],mep[29:34])
test(prev[31:34],mep[29:33])
test(prev[1:14],mep[0:13])
test(prev,mep)
